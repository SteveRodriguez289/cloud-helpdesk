<!DOCTYPE html>
<html>
<head>
<title>Helpdesk Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  display:flex;
}

.sidebar {
  width:220px;
  background:#1f2937;
  color:white;
  height:100vh;
  padding:20px;
}

.sidebar h2 {
  font-size:18px;
  margin-bottom:30px;
}

.sidebar a {
  display:block;
  color:#cbd5e1;
  text-decoration:none;
  margin:15px 0;
}

.sidebar a:hover {
  color:white;
}

.main {
  flex:1;
  padding:30px;
}

.card-container {
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:20px;
  margin-bottom:30px;
}

.card {
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}

.card h3 {
  margin:0;
  font-size:14px;
  color:#64748b;
}

.card p {
  font-size:24px;
  margin-top:10px;
}

.table-container {
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  padding:10px;
  text-align:left;
}

th {
  background:#f1f5f9;
}

.status {
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
  color:white;
}

.status.Open { background:#3b82f6; }
.status.Closed { background:#10b981; }
.status.Pending { background:#f59e0b; }

button {
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2563eb;
  color:white;
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>Help Desk</h2>
  <a href="#">Dashboard</a>
  <a href="#">Tickets</a>
  <a href="#">Reports</a>
  <a href="#">Settings</a>
</div>

<div class="main">
  <h1>Support Overview</h1>

  <div class="card-container">
    <div class="card">
      <h3>Total Tickets</h3>
      <p id="totalTickets">0</p>
    </div>
    <div class="card">
      <h3>Open</h3>
      <p id="openTickets">0</p>
    </div>
    <div class="card">
      <h3>Closed</h3>
      <p id="closedTickets">0</p>
    </div>
    <div class="card">
      <h3>Pending</h3>
      <p id="pendingTickets">0</p>
    </div>
  </div>

  <canvas id="ticketChart" height="100"></canvas>

  <br>

  <div class="table-container">
    <h2>Tickets</h2>
    <button onclick="loadTickets()">Refresh</button>
    <br><br>
    <table id="ticketTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Status</th>
          <th>Created</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script>
let apiKey = localStorage.getItem("apiKey") || prompt("Enter API Key");
localStorage.setItem("apiKey", apiKey);

async function loadTickets() {
  const res = await fetch("/tickets", {
    headers: { "X-API-KEY": apiKey }
  });
  const data = await res.json();

  const tbody = document.querySelector("#ticketTable tbody");
  tbody.innerHTML = "";

  let open=0, closed=0, pending=0;

  data.forEach(t => {
    if(t.status==="Open") open++;
    if(t.status==="Closed") closed++;
    if(t.status==="Pending") pending++;

    tbody.innerHTML += `
      <tr>
        <td>${t.id}</td>
        <td>${t.title}</td>
        <td><span class="status ${t.status}">${t.status}</span></td>
        <td>${new Date(t.created_at).toLocaleString()}</td>
      </tr>`;
  });

  document.getElementById("totalTickets").innerText = data.length;
  document.getElementById("openTickets").innerText = open;
  document.getElementById("closedTickets").innerText = closed;
  document.getElementById("pendingTickets").innerText = pending;

  renderChart(open, closed, pending);
}

function renderChart(open, closed, pending) {
  new Chart(document.getElementById("ticketChart"), {
    type: 'doughnut',
    data: {
      labels: ["Open","Closed","Pending"],
      datasets: [{
        data: [open, closed, pending],
        backgroundColor: ["#3b82f6","#10b981","#f59e0b"]
      }]
    }
  });
}

loadTickets();
</script>

</body>
</html>

